<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>回测报告</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>
    <style>
        body { background-color: #f8f9fa; }
        .chart-container { width: 100%; height: 400px; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,.1); margin-top: 20px; }
        .kpi-card { text-align: center; }
        .kpi-value { font-size: 1.5rem; font-weight: bold; }
        .kpi-label { font-size: 0.9rem; color: #6c757d; }
        .positive { color: #198754; }
        .negative { color: #dc3545; }
    </style>
</head>
<body>
<div class="container mt-4">
    <h1 class="mb-4">回测报告</h1>

    <!-- 报告元数据 -->
    <div class="card mb-4">
        <div class="card-header">报告详情</div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4"><strong>策略名称:</strong> <span th:text="${report.strategyName}"></span></div>
                <div class="col-md-4"><strong>股票代码:</strong> <span th:text="${report.symbol}"></span></div>
                <div class="col-md-4"><strong>报告ID:</strong> <small class="text-muted" th:text="${report.id}"></small></div>
            </div>
            <div class="row mt-2">
                <div class="col-md-4"><strong>回测周期:</strong> <span th:text="${report.startDate} + ' to ' + ${report.endDate}"></span></div>
                <div class="col-md-4"><strong>报告生成时间:</strong> <span th:text="${#temporals.format(report.backtestRunTime, 'yyyy-MM-dd HH:mm:ss')}"></span></div>
            </div>
        </div>
    </div>

    <!-- 关键指标汇总 -->
    <div class="row">
        <!-- 在这里动态生成关键指标卡片 -->
    </div>

    <!-- 权益曲线图 -->
    <div class="card">
        <div class="card-header">权益曲线 (Equity Curve)</div>
        <div class="card-body">
            <div id="equityCurveChart" class="chart-container"></div>
        </div>
    </div>

    <!-- TODO: 其他图表容器 -->

</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script th:inline="javascript">
    /*<![CDATA[*/

    // 1. 权益曲线图
    var equityCurveChart = echarts.init(document.getElementById('equityCurveChart'));
    var equityDates = /*[[${equityDates}]]*/ [];
    var equityValues = /*[[${equityValues}]]*/ [];

    var equityOption = {
        tooltip: {
            trigger: 'axis',
            axisPointer: { type: 'cross' }
        },
        xAxis: {
            type: 'category',
            data: equityDates
        },
        yAxis: {
            type: 'value',
            scale: true,
            axisLabel: { formatter: '{value}' }
        },
        series: [{
            name: '总权益',
            type: 'line',
            data: equityValues,
            smooth: true,
            showSymbol: false,
            lineStyle: { color: '#0d6efd' }
        }]
    };
    equityCurveChart.setOption(equityOption);

    // 窗口大小改变时重绘图表
    window.addEventListener('resize', function() {
        equityCurveChart.resize();
    });

    /*]]>*/
</script>
</body>
</html>
